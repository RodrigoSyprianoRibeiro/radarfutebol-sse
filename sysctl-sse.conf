# Configuracoes sysctl para servidor SSE de alta performance
# Copiar para: /etc/sysctl.d/99-sse-performance.conf
# Aplicar: sysctl -p /etc/sysctl.d/99-sse-performance.conf

# ============================================
# CONEXOES TCP
# ============================================

# Aumenta backlog de conexoes pendentes
net.core.somaxconn = 65535
net.core.netdev_max_backlog = 65535

# Aumenta range de portas locais
net.ipv4.ip_local_port_range = 1024 65535

# Permite reusar conexoes TIME_WAIT rapidamente
net.ipv4.tcp_tw_reuse = 1

# Reduz tempo de espera de conexoes
net.ipv4.tcp_fin_timeout = 15

# Aumenta backlog de syn (conexoes pendentes)
net.ipv4.tcp_max_syn_backlog = 65535

# ============================================
# BUFFERS DE REDE
# ============================================

# Memoria minima/padrao/maxima para buffers TCP
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# ============================================
# KEEPALIVE (para conexoes SSE longas)
# ============================================

# Tempo antes de enviar primeiro keepalive (segundos)
net.ipv4.tcp_keepalive_time = 60

# Intervalo entre keepalives (segundos)
net.ipv4.tcp_keepalive_intvl = 10

# Numero de keepalives antes de desistir
net.ipv4.tcp_keepalive_probes = 6

# ============================================
# FILE DESCRIPTORS
# ============================================

# Maximo de file handles do sistema
fs.file-max = 2097152

# Maximo de file handles por processo
fs.nr_open = 1048576

# ============================================
# MEMORIA
# ============================================

# Evita swap agressivo
vm.swappiness = 10

# Permite overcommit de memoria (Go GC funciona melhor)
vm.overcommit_memory = 1
